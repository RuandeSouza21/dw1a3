var height = 6;
var width = 5; 

var row = 0; 
var col = 0; 

var gameOver = false;

var wordList = ["termo","festa","bebia","honra","ouvir","pesco","fungo","pagam","ginga","pinta","poder","pilha","sarar","fruta","piano","notar","musgo","tensa","feliz","miojo","pagos","texto","ameno","chuva","coral","forte","tonta","temor","ligar","rolar","navio","limbo","calvo","fedor","balde","talco","crime","grade","carta","flora","comum","fatal","pecar","feroz","armar","couro","ecoar","falir","tecer","arena","justo","ruiva","dupla","touca","sogro","treta","sadio","molas","certo","risco","bossa","porre","tigre","vocal","treze","sueco","verbo","latim","povos","longo","lotar","depor","cento","trava","ditos","polir","cacos","lindo","pegar","pilar","passo","piada","puxar","manta","barba","subir","tosse","adega","veias","mesma","mirim","mansa","nobre","grama","ritmo","samba","ardor","daqui","bravo","surfe","tanto","imune","lucro","finos","bocas","toldo","major","cabos","estar","focal","queda","juros","elite","burro","fundo","duelo","breve","bolso","linha","parir","furar","quina","pasta","suíno","dosar","cervo","sujar","corda","macia","reler","musas","verme","focar","anual","cerco","porca","fraco","punho","acima","bolha","tanga","globo","rampa","goela","reais","cheio","fosso","pouco","danos","salas","mimar","sanha","suave","antro","total","polvo","jejum","atriz","recuo","fluir","muito","ficar","bucha","magro","frota","idoso","multa","primo","banal","jorro","sismo","etapa","modas","colar","muita","papel","ruela","meias","gripe","causa","menor","nulos","caule","rubor","optar","redor","nação","galho","roubo","parto","cenas","lesar","odiar","usual","latir","altos","livre","vosso","geada","etnia","trevo","rezar","bucal","vetor","filho","miolo","ordem","valor","filha","antes","vetar","surra","prata","ceder","frear","quilo","rombo","lomba","praia","urnas","aveia","picar","arcar","jaula","gerar","trena","gemer","riste","busto","visar","velha","adaga","crase","feras","missa","cobra","briga","dardo","berço","palmo","ralar","reles","blusa","super","grata","longa","tarso","vulto","lenda","grego","pinos","obeso","sauna","assim","troco","infra","pudor","cofre","prece","junho","manco","pisar","posse","copas","ninfa","gruta","regra","citar","mural","fases","mando","frios","gelar","chave","sobra","opaco","lagos","corpo","doses","basco","vinda","sujos","igual","julho","acaso","dados","favor","pente","beata","chulo","rumos","cubos","tento","toque","polpa","ombro","raras","pneus","canil","funil","perto","coala","amplo","orgia","doces","sobre","motel","trufa","voraz","azedo","coeso","calmo","enfim","mitos","feios","palha","andar","crepe","pingo","malte","monge","salto","rímel","lauda","damas","sadia","truco","oeste","selva","reter","bolsa","anexo","renda","lobos","vício","zebra","modos","praxe","pudim","birra","praça","pedra","olhar","pizza","banho","bucho","afins","maior","cabra","irado","macio","troca","salmo","casta","trupe","morna","falso","lidar","afeto","verso","belos","denso","moeda","vaiar","aulas","ganho","chapa","jarra","velho","grilo","sigma","farsa","sigla","clone","cesta","anjos","rugir","luzes","parvo","censo","virar","apito","gosto","casto","fraca","agudo","sovar","fatos","torso","tumba","veste","secar","berro","sutis","bispo","pesar","digno","bamba","broca","hiato","clube","totem","prumo","meios","vulgo","esqui","épico","minha","ainda","remar","manso","ousar","viral","trote","artes","facas","brava","meiga","campo","levar","preta","lebre","pobre","gesso","sabiá","freio","marte","clara","magos","reino","murro","calar","prosa","feita","folga","patas","vogal","divas","borda","penar","errar","morto","forma","vapor","circo","faixa","beijo","pedir","tropa","vital","vento","vespa","negro","pardo","local","beato","quais","frase","sucos","botão","balsa","foice","nozes","dente","cedro","aceno","repor","leque","drama","forno","tarde","sarro","certa","trama","milho","dreno","carma","poeta","nunca","ficha","molho","toada","trens","ciclo","leigo","golpe","haver","varal","ritos","fibra","nervo","sagaz","gente","pombo","zinco","pavor","feixe","pular","titia","deter","axila","brejo","rever","naipe","arder","pleno","parma","noite","seiva","furor","janta","mover","vidro","votar","brasa","areal","jarro","ninja","nossa","boiar","outra","pires","regar","boato","sumir","lenta","loira","cinza","fisco","agora","lazer","pista","pulga","fosca","males","conto","tocha","retas","cuspe","persa","tenda","meros","lados","areia","impor","vigor","matiz","senso","novas","turco","densa","balas","bicho","atual","monte","tribo","tarda","baita","ampla","floco","banjo","olhos","gasto","acesa","torto","horta","vivos","gaita","solto","cetro","redes","criar","sacro","banir","prato","gorro","aliar","bater","fauna","norte","haste","alado","bloco","pinga","corja","morno","ideal","vozes","sogra","jovem","testa","metal","falsa","bruto","tenso","dique","fator","sutil","grupo","matar","motor","meses","vazio","cujos","parda","carpa","plebe","advir","punir","rival","trave","lento","sarda","gozar","caber","sexta","sacra","rolha","açude","casos","chata","ossos","expor","venda","casco","banco","bomba","sinal","horto","ramos","fonte","leito","cobre","cinco","noiva","ponto","aluno","traje","canal","rouco","boate","caros","lente","lares","sacar","feudo","vezes","carga","presa","geral","negar","atuar","fiado","corvo","gordo","tutor","duros","exame","caldo","cupim","ótimo","mamar","autos","pavio","fobia","jeito","votos","lagoa","pampa","diodo","parte","ambas","farda","sonar","bacon","gatas","banca","meigo","fixos","doido","valer","girar","fofas","caspa","macro","prego","perda","enjoo","longe","ferro","unida","bambu","dorso","moral","ameba","viril","amora","magna","rural","penal","abuso","sunga","erros","surda","beber","cifra","farol","fugaz","zerar","menta","estes","vista","final","nevar","norma","leste","nudez","telas","tinto","saber","bingo","cacau","fardo","morar","bioma","domar","grega","coice","ervas","medir","mista","atroz","raios","tosar","muros","santa","desde","posto","cesto","abril","penta","celta","mudar","cacho","bando","caixa","resto","libra","calda","preto","vazar","reger","usina","vazia","todos","durar","rimar","angra","selos","bufar","nuvem","lapso","civis","grito","bônus","cinto","matos","safra","algoz","letra","dogma","pesca","linho","tchau","graxa","casal","lidos","zonas","lorde","larva","gnomo","casca","botar","tinta","prado","bacia","magia","saque","grato","bares","rolos","loura","viola","linda","cueca","santo","couve","susto","ostra","altar","limpo","trair","deusa","usura","todas","obter","tampa","fossa","lavar","gueto","lunar","panda","rigor","humor","pulso","terno","donos","coxão","civil","bocal","aroma","soldo","morro","coxas","cupom","jogos","furos","arcos","louca","peste","crise","homem","duplo","pauta","canja","cauda","dizer","rapaz","atlas","jogar","sítio","guiar","babar","trono","trigo","novos","massa","horas","junto","salsa","pinho","brisa","ambos","guria","brega","motim","rumor","ducha","misto","farto","dicas","canto","cargo","seita","graus","baile","zelar","apelo","arroz","canoa","perna","tarja","vasos","fluxo","falar","dobro","leite","curso","comer","cisne","cheia","lugar","prazo","letal","fiapo","vinte","clipe","tomar","manto","gesto","praga","licor","inato","lance","lesma","beira","abono","russo","caqui","pelos","servo","barro","filme","rouca","nisto","corar","idade","lisos","selim","peixe","untar","sanar","grana","panos","relva","plena","besta","banda","feira","pompa","veloz","belas","poema","tecla","adeus","dobra","fruto","sorte","sushi","quibe","corno","tosco","valsa","lacre","fosco","clero","dever","aviso","prole","costa","manga","metro","pirar","verde","vacas","suado","fixar","loiro","fogos","dunas","radar","baixa","frevo","terra","calva","harpa","dueto","prova","pluma","justa","pagar","farpa","cerca","rosca","euros","curar","fenda","farra","unhas","nomes","gosma","capuz","ileso","lenha","perua","padre","fazer","tocar","bruxo","lojas","lerdo","nisso","golfo","topar","usada","ruivo","nadar","lixar","vidas","pomba","dotar","raiar","batom","ontem","torpe","cloro","curva","surto","ricos","ursos","hiena","vasta","risos","febre","fumar","lutar","catar","trela","litro","surdo","menos","choro","chefe","vasto","cetim","extra","greve","tapar","sarau","rosas","touro","trapo","abano","delta","anzol","sarna","clave","claro","nasal","burra","conde","ponte","ondas","quota","mexer","verba","aonde","obras","idosa","signo","frias","mundo","legal","tempo","culta","vinho","livro","ninho","germe","culto","pasto","podre","mirar","teses","naves","afago","laudo","ditar","selar","garra","folia","pedal","ninar","tirar","fugir","calor","naval","porta","âmago","ponta","calma","capaz","genro","almas","feias","barco","zonzo","senha","focos","rosto","socar","carne","garfo","luvas","chiar","porco","gases","boina","ferir","roupa","duque","bonde","tiros","avaro","exato","basta","viver","placa","disso","poros","arame","outro","sopas","bruxa","raiva","museu","astro","rente","lombo","bordo","cinta","palco","folha","treco","casar","louco","turvo","rádio","tipos","somar","achar","macho","ajuda","times","meter","mosca","milha","carro","algum","conta","nicho","sabor","natal","cerne","torta","apoio","fetal","hotel","setor","vesgo","amada","firma","calça","aspas","latas","quase","creme","telha","teias","assar","lousa","baque","rubro","fotos","adiar","polar","coroa","pomar","tripa","mesmo","jegue","álbum","custo","laico","dedos","ganso","visor","abrir","bazar","gerir","mania","rodar","turno","sexto","palma","parco","pouso","moela","tenor","amido","solar","poste","urubu","coisa","seara","xampu","dieta","rocha","turma","paiol","pouca","vinil","frade","tonto","cavar","nariz","torre","parar","supor","cravo","tosca","clima","chato","moita","vagar","pausa","truta","podar","posar","autor","cruel","retro","dores","credo","hinos","capim","tango","vocês","jurar"]

var guessList = []

guessList = guessList.concat(wordList);

var word = wordList[Math.floor(Math.random()*wordList.length)].toUpperCase();
console.log(word);

window.onload = function(){
    intialize();
}


function intialize() {

    // Criar o game board
    for (let r = 0; r < height; r++) {
        for (let c = 0; c < width; c++) {
            // <span id="0-0" class="tile">P</span>
            let tile = document.createElement("span");
            tile.id = r.toString() + "-" + c.toString();
            tile.classList.add("tile");
            tile.innerText = "";
            document.getElementById("board").appendChild(tile);
        }
    }

    // Criar o key board
    let keyboard = [
        ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P"],
        ["A", "S", "D", "F", "G", "H", "J", "K", "L", " "],
        ["Enter", "Z", "X", "C", "V", "B", "N", "M", "⌫" ]
    ]

    for (let i = 0; i < keyboard.length; i++) {
        let currRow = keyboard[i];
        let keyboardRow = document.createElement("div");
        keyboardRow.classList.add("keyboard-row");

        for (let j = 0; j < currRow.length; j++) {
            let keyTile = document.createElement("div");

            let key = currRow[j];
            keyTile.innerText = key;
            if (key == "Enter") {
                keyTile.id = "Enter";
            }
            else if (key == "⌫") {
                keyTile.id = "Backspace";
            }
            else if ("A" <= key && key <= "Z") {
                keyTile.id = "Key" + key; 
            }

            keyTile.addEventListener("click", processKey);

            if (key == "Enter") {
                keyTile.classList.add("enter-key-tile");
            } else {
                keyTile.classList.add("key-tile");
            }
            keyboardRow.appendChild(keyTile);
        }
        document.body.appendChild(keyboardRow);
    }


    
    document.addEventListener("keyup", (e) => {
        processInput(e);
    })
}

function processKey() {
    e = { "code" : this.id };
    processInput(e);
}

function processInput(e) {
    if (gameOver) return;

    
    if ("KeyA" <= e.code && e.code <= "KeyZ") {
        if (col < width) {
            let currTile = document.getElementById(row.toString() + '-' + col.toString());
            if (currTile.innerText == "") {
                currTile.innerText = e.code[3];
                col += 1;
            }
        }
    }
    else if (e.code == "Backspace") {
        if (0 < col && col <= width) {
            col -=1;
        }
        let currTile = document.getElementById(row.toString() + '-' + col.toString());
        currTile.innerText = "";
    }

    else if (e.code == "Enter") {
        update();
    }

    if (!gameOver && row == height) {
        gameOver = true;
        alert(`Que pena você perdeu. A palavra era ${word}.`);
    }
}

function update() {
    let guess = "";
    document.getElementById("answer").innerText = "";

    
    for (let c = 0; c < width; c++) {
        let currTile = document.getElementById(row.toString() + '-' + c.toString());
        let letter = currTile.innerText;
        guess += letter;
    }

    guess = guess.toLowerCase(); 
    console.log(guess);

    if (!guessList.includes(guess)) {
        document.getElementById("answer").innerText = "Palavra não aceita";
        return;
    }

    
    let correct = 0;

    let letterCount = {}; 
    for (let i = 0; i < word.length; i++) {
        let letter = word[i];

        if (letterCount[letter]) {
           letterCount[letter] += 1;
        }
        else {
           letterCount[letter] = 1;
        }
    }

    console.log(letterCount);

    
    for (let c = 0; c < width; c++) {
        let currTile = document.getElementById(row.toString() + '-' + c.toString());
        let letter = currTile.innerText;

        
        if (word[c] == letter) {
            currTile.classList.add("correct");

            let keyTile = document.getElementById("Key" + letter);
            keyTile.classList.remove("present");
            keyTile.classList.add("correct");

            correct += 1;
            letterCount[letter] -= 1; 
        }

        if (correct == width) {
            gameOver = true;
            alert('Você ganhou!')
        }
    }

    console.log(letterCount);
    
    for (let c = 0; c < width; c++) {
        let currTile = document.getElementById(row.toString() + '-' + c.toString());
        let letter = currTile.innerText;

        
        if (!currTile.classList.contains("correct")) {
            
            if (word.includes(letter) && letterCount[letter] > 0) {
                currTile.classList.add("present");

                let keyTile = document.getElementById("Key" + letter);
                if (!keyTile.classList.contains("correct")) {
                    keyTile.classList.add("present");
                }
                letterCount[letter] -= 1;
            } 
            else {
                currTile.classList.add("absent");
                let keyTile = document.getElementById("Key" + letter);
                keyTile.classList.add("absent")
            }
        }
    }

    row += 1; 
    col = 0; 
}
